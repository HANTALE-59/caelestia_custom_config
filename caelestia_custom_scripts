#!/bin/bash

CONFIG="$HOME/.config/caelestia/shell.json"
DECORATION_FILE="$HOME/.config/caelestia/hypr-user.conf"

# âš ï¸ Chemin EXACTEMENT comme dans ton fichier (avec $HOME non expansÃ©)
BLACK_WHITE_TARGET='screen_shader = $HOME/.config/hypr/custom/BWshader.glsl'

case "$1" in
  black_white)
    # ðŸ” Si la ligne est commentÃ©e â†’ dÃ©commenter
    if grep -q "^[[:space:]]*#${BLACK_WHITE_TARGET}" "$DECORATION_FILE"; then
      sed -i "s|^[[:space:]]*#${BLACK_WHITE_TARGET}|    ${BLACK_WHITE_TARGET}|" "$DECORATION_FILE"
      sleep 0.5
      jq '(.launcher.actions[] | select(.name=="B & W") | .icon) = "contrast_rtl_off"' \
         "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"

    # ðŸ” Si la ligne est active â†’ commenter
    elif grep -q "^[[:space:]]*${BLACK_WHITE_TARGET}" "$DECORATION_FILE"; then
      sed -i "s|^[[:space:]]*${BLACK_WHITE_TARGET}|    #${BLACK_WHITE_TARGET}|" "$DECORATION_FILE"
      sleep 0.5
      jq '(.launcher.actions[] | select(.name=="B & W") | .icon) = "contrast"' \
         "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"

    else
      echo "âŒ Impossible de trouver la ligne du shader !"
    fi
    ;;
  transp)
    current=$(jq '.appearance.transparency.enabled' "$CONFIG")
    if [ "$current" = "true" ]; then
      jq '.appearance.transparency.enabled = false' "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
      sleep 0.5
      jq '(.launcher.actions[] | select(.name=="Transparency") | .icon) = "invert_colors_off"' \
         "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
    else
      jq '.appearance.transparency.enabled = true' "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
      sleep 0.5
      jq '(.launcher.actions[] | select(.name=="Transparency") | .icon) = "invert_colors"' \
         "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
    fi
    ;;
  bar)
    current=$(jq '.bar.persistent' "$CONFIG")
    if [ "$current" = "true" ]; then
      jq '.bar.persistent = false' "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
      sleep 0.5
      jq '(.launcher.actions[] | select(.name=="Bar") | .icon) = "left_panel_open"' \
         "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"

    else

      jq '.bar.persistent = true' "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
      sleep 0.5
      jq '(.launcher.actions[] | select(.name=="Bar") | .icon) = "right_panel_open"' \
         "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
    fi
    ;;
  *)
    echo "Usage : $0 [transp|bar|black_white]"
    exit 1
    ;;
esac
