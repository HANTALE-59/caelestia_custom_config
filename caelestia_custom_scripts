#!/bin/bash

CONFIG="$HOME/.config/caelestia/shell.json"
DECORATION_FILE="$HOME/.config/caelestia/hypr-user.conf"

# âš ï¸ Chemin EXACTEMENT comme dans ton fichier (avec $HOME non expansÃ©)
BLACK_WHITE_TARGET='screen_shader = $HOME/.config/hypr/custom/BWshader.glsl'

case "$1" in
  black_white)
    # ðŸ” Si la ligne est commentÃ©e â†’ dÃ©commenter
    if grep -q "^[[:space:]]*#${BLACK_WHITE_TARGET}" "$DECORATION_FILE"; then
      sed -i "s|^[[:space:]]*#${BLACK_WHITE_TARGET}|    ${BLACK_WHITE_TARGET}|" "$DECORATION_FILE"
      echo "Shader activÃ© (ligne dÃ©commentÃ©e)."

    # ðŸ” Si la ligne est active â†’ commenter
    elif grep -q "^[[:space:]]*${BLACK_WHITE_TARGET}" "$DECORATION_FILE"; then
      sed -i "s|^[[:space:]]*${BLACK_WHITE_TARGET}|    #${BLACK_WHITE_TARGET}|" "$DECORATION_FILE"
      echo "Shader dÃ©sactivÃ© (ligne commentÃ©e)."

    else
      echo "âŒ Impossible de trouver la ligne du shader !"
    fi
    ;;
  transp)
    current=$(jq '.appearance.transparency.enabled' "$CONFIG")
    if [ "$current" = "true" ]; then
      jq '.appearance.transparency.enabled = false' "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
      echo "ðŸ”² Transparency dÃ©sactivÃ©e"
    else
      jq '.appearance.transparency.enabled = true' "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
      echo "ðŸŸ¦ Transparency activÃ©e"
    fi
    ;;
  bar)
    current=$(jq '.bar.persistent' "$CONFIG")
    if [ "$current" = "true" ]; then
      jq '.bar.persistent = false' "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
      echo "ðŸ”² Barre masquÃ©e"
    else
      jq '.bar.persistent = true' "$CONFIG" > "$CONFIG.tmp" && mv "$CONFIG.tmp" "$CONFIG"
      echo "ðŸŸ¦ Barre affichÃ©e"
    fi
    ;;
  *)
    echo "Usage : $0 [transp|bar|black_white]"
    exit 1
    ;;
esac
